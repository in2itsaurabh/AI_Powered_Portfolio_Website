<!-- Chat Toggle Button -->
<div class="chatbot-button" onclick="toggleChatbox()">💬</div>

<!-- Chatbox -->
<div class="chatbox" id="chatbox">
  <div class="chat-header">Pro-Serve Chatbot</div>
  <div class="chatbox-content" id="chatMessages"></div>
  <div class="chat-input-container">
    <input type="text" id="userInput" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
  <div class="emojis">
    <span class="emoji" onclick="addEmoji('😊')">😊</span>
    <span class="emoji" onclick="addEmoji('😎')">😎</span>
    <span class="emoji" onclick="addEmoji('😍')">😍</span>
    <span class="emoji" onclick="addEmoji('🤣')">🤣</span>
    <span class="emoji" onclick="addEmoji('😢')">😢</span>
    <span class="emoji" onclick="addEmoji('🤔')">🤔</span>
    <span class="emoji" onclick="addEmoji('👍')">👍</span>
  </div>
  <script>
    function toggleChatbox() {
      const chatbox = document.getElementById('chatbox');
      chatbox.style.display = chatbox.style.display === 'flex' ? 'none' : 'flex';
    }

    function sendMessage() {
      const input = document.getElementById("userInput");
      const messages = document.getElementById("chatMessages");
      const userText = input.value.trim();

      if (userText === "") return;

      messages.innerHTML += `<div class="message"><div class="user-message">${userText}</div></div>`;
      input.value = "";
      messages.scrollTop = messages.scrollHeight;

      const lowerText = userText.toLowerCase();
      if (["hi", "hello", "hey"].includes(lowerText)) {
        setTimeout(() => {
          messages.innerHTML += `<div class="message"><div class="bot-message">Hi there! 👋</div></div>`;
          messages.scrollTop = messages.scrollHeight;
        }, 500);
        return;
      }

      // Update the fetch URL as needed for your backend chatbot handler.
      fetch('/ask', {
        method: 'POST',
        body: new URLSearchParams('query=' + userText),
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      })
      .then(response => response.json())
      .then(data => {
        messages.innerHTML += `<div class="message"><div class="bot-message">${data.output}</div></div>`;
        messages.scrollTop = messages.scrollHeight;
      });
    }

    document.getElementById("userInput").addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage();
      }
    });

    function addEmoji(emoji) {
      const input = document.getElementById("userInput");
      input.value += emoji;
      input.focus();
    }
  </script>
